extends ../../layout/default.pug
include ../../mixins/modal.pug

block main
  link(rel="stylesheet", href="/css/admin/blog/modal.css")
  style.

    .cat-title {
      padding: 5px 10px;
      margin: 8px 0px;
      background: #d5e6e9;
      width: max-content;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .table-css tr:hover .cat-title {
      color: black;
    }

  if (role.permissions.includes("blog_view"))

    h1.title Blogs

    .container-fluid.pt-2
      // FILTER START
      .card.shadow-css.p-3.mb-5
        form(action='' form-filter)
          .card-body
            h2.card-title.pb-3 Filter
            .row
              .col-2
                label.form-label(for='filter-name') Filter name: 
                input.form-control(type='text' placeholder="Input name ..." id="filter-name")
              .col-2
                label.form-label(for='filter-active') Filter active: 
                select.form-select(name='' id='filter-active')
                  option(value="") All
                  option(value="active") Active 
                  option(value="inactive") Inactive
                  option(value="pending") Pending 
                  option(value="draft") Draft

              .col-2
                label.form-label(for='filter-featured') Filter featured: 
                select.form-select(name='' id='filter-featured')
                  option(value="") All
                  option(value="true") True 
                  option(value="false") False   
              .col-3
                label.form-label(for='filter-sort') Filter sort: 
                select.form-select(name='' id='filter-sort')
                  option(value="") Sort 
                  option(value="position-desc") Vị trí giảm dần  
                  option(value="position-asc") Vị trí tăng dần
              .col-3
                label.form-label(for='filter-sort') Filter category:
                select.form-select(name='' id="filter-category")
                  option(value='') All
                    //- if (newRecords)
                    //-   each item in newRecords
                    //-     option(value=item._id) #{item.prefixTitle} (#{item.productCount})
            .row.mt-2
              .col-3
                button.btn.btn-primary(type="submit" btn-filter)
                  <i class="fa-solid fa-filter mr-1" style="border: none"></i> Filter
      // FILTER END
      // LIST PRODUCTS START
      .card.shadow-css.p-3.mb-5
        .card-body
          h2.card-title.pb-3 List Blogs
          if (role.permissions.includes('blog_edit'))
            .row
              .col-6
                .input-group
                  input.form-control(type='file')
                  button.btn.btn-success  + Import
                  button.btn.btn-secondary  - Export
              .col-1
              .col-4
                if (role.permissions.includes('blog_edit'))
                  form(
                    action=`${prefixAdmin}/blog/change-multi?_method=PATCH`
                    method="POST"
                    form-change-multi
                  )
                    .input-group
                      select.form-select(name='type' id='')
                        option(disable selected) Choose active
                        option(value="active") Active 
                        option(value="inactive") Inactive 
                        option(value="pending") Pending 
                        option(value="draft") Draft 
                        option(value="featured-true") Featured true
                        option(value="featured-false") Featured false
                        if (role.permissions.includes('blog_delete'))
                          option(value="delete") Delete
                      input(
                        type="text"
                        name="ids"
                        value=""
                        class="form-control"
                        class="d-none"
                      )
                      button.btn.btn-primary(type="submit") Apply Action 
              .col-1
                if (role.permissions.includes('blog_create'))
                  a.btn.btn-primary(href=`${prefixAdmin}/blog/create`)  + New
          .row.p-2.mt-3
            table.table-css.mb-5(checkbox-multi)
              thead
                tr
                  if (role.permissions.includes('blog_edit'))
                    td 
                      input(type="checkbox" name="checkall")
                  td(scope='col') Image
                  td(scope='col') Title
                  td(scope="col") Category
                  td(scope='col') Author
                  td(scope='col') Position
                  td(scope='col') Featured
                  td(scope='col') Status
                  td(scope='col') PublishAt
                  td(scope='col') Action
              tbody
                each item, index in blog
                  tr 
                    if (role.permissions.includes('blog_edit'))
                      td 
                        input(type="checkbox" name="id" value=item.id)
                    td 
                      img( alt=item.title width='100px' class="img-thumbnail")
                    td=item.title
                    td
                      if item.blog_category.length > 0
                        each cat in item.blog_category 
                          .cat-title #{cat.title}
                      else 
                        .cat-title No Category
                    td
                      if (item.createdBy && item.createdBy.accountId)
                        | #{item.createdBy.accountId.fullName}
                      else
                        | N/A
                    if (role.permissions.includes('blog_edit'))              
                      td 
                        form(
                          action="" 
                          form-change-position
                          method="POST"
                          data-path=`${prefixAdmin}/blog/change-position`
                        )
                          input(
                            change-position
                            type="text"
                            min="1"
                            name="position"
                            value=item.position 
                            idItem=item._id
                            class="form-control"
                            style="width: 50px; text-align: center"
                          ) 
                    else 
                      td.text-center=item.position
                    if (role.permissions.includes('blog_edit'))
                      td 
                        if(item.featured == true)
                          a(
                            href="javascript:;" 
                            btn-change-featured
                            itemFeatured=item.featured
                            itemId=item._id
                            class='badge badge-success p-2'
                            style="font-size: 0.9rem"
                          ) True
                        else 
                          a(
                            href="javascript:;" 
                            btn-change-featured
                            itemFeatured=item.featured
                            itemId=item._id
                            class='badge badge-danger p-2'
                            style="font-size: 0.9rem"
                          ) False
                    else  
                      td 
                        if (item.featured == true)
                          p.text-success True
                        else 
                          p.text-danger False
                    td=item.status
                    td 
                      p #{moment(item.createdAt).format("DD/MM/YYYY")}
                      i #{moment(item.createdAt).format("HH:mm")}
                    td  
                      a(
                          href=`${prefixAdmin}/blog/read/${item._id}`
                          class='btn btn-primary btn-sm p-2 m-2'
                          style="font-size: 0.9rem"
                          data-bs-toggle="tooltip" 
                          data-bs-placement="top" 
                          data-bs-offset="0,10"
                          data-bs-custom-class="custom-tooltip"
                          title="Read"
                      ) <i class="fa-brands fa-readme"></i>
                      if (role.permissions.includes('blog_edit'))
                        a(
                          href=`${prefixAdmin}/blog/edit/${item._id}`
                          class='btn btn-warning btn-sm p-2 m-2'
                          style="font-size: 0.9rem"
                          data-bs-toggle="tooltip" 
                          data-bs-placement="top" 
                          data-bs-offset="0,10"
                          data-bs-custom-class="custom-tooltip"
                          title="Edit"
                        ) <i class="fa-solid fa-pen-to-square"></i>
                        if (role.permissions.includes('blog_delete'))
                          button(
                            class='btn btn-danger btn-sm p-2 m-2'
                            button-delete
                            data-id=item._id
                            style="font-size: 0.9rem"
                            data-bs-toggle="tooltip" 
                            data-bs-placement="top"
                            data-bs-offset="0,10"
                            data-bs-custom-class="custom-tooltip"
                            title="Delete"
                          ) <i class="fa-regular fa-trash"></i>
                        button(
                          class='btn btn-secondary btn-sm p-2 m-2'
                          style="font-size: 0.9rem"
                          data-bs-toggle="tooltip" 
                          data-bs-placement="top" 
                          data-bs-offset="0,10"
                          data-bs-custom-class="custom-tooltip"
                          title="Statistical"
                          btn-show-statistical
                          data-product=JSON.stringify(item)
                        ) <i class="fa-solid fa-chart-bar"></i>


          //- .row
            if (role.permissions.includes('blog_delete'))
              .col-9
                nav(aria-label='Page navigation example')
                  ul.pagination
                    li.page-item
                      button.page-link(page-pagination=pagination.currentPage-1)
                        span(aria-hidden='true') &laquo;
                    - for(let i = 1; i <= pagination.totalPage; i ++) 
                      li(class=`page-item ${pagination.currentPage == i ? "active" : ""}`)
                        button.page-link(page-pagination=i) #{i}
                    li.page-item
                      button.page-link(page-pagination=pagination.currentPage+1)
                        span(aria-hidden='true') &raquo;
              .col-2
                form(
                  action=""
                  form-number-items-page
                )
                  select.form-select(name='numberItemPage' select-number-items-page)
                    - for (let i = 4; i <= 10; i += 2)
                      option(value=i selected=(pagination.limitItem == i ? true : false)) #{i} items per page
              .col-1
                a(
                  class='btn btn-dark sm p-2'
                  style="font-size: 0.9rem"
                  data-bs-toggle="tooltip" 
                  data-bs-placement="top"
                  data-bs-offset="0,10"
                  data-bs-custom-class="custom-tooltip"
                  title="Trash"
                  href="/admin/blog/trash"
                ) <i class="fa-regular fa-trash"></i>
            else 
              .col-10
                nav(aria-label='Page navigation example')
                  ul.pagination
                    li.page-item
                      button.page-link(page-pagination=pagination.currentPage-1)
                        span(aria-hidden='true') &laquo;
                    - for(let i = 1; i <= pagination.totalPage; i ++) 
                      li(class=`page-item ${pagination.currentPage == i ? "active" : ""}`)
                        button.page-link(page-pagination=i) #{i}
                    li.page-item
                      button.page-link(page-pagination=pagination.currentPage+1)
                        span(aria-hidden='true') &raquo;
              .col-2
                form(
                  action=""
                  form-number-items-page
                )
                  select.form-select(name='numberItemPage' select-number-items-page)
                    - for (let i = 4; i <= 10; i += 2)
                      option(value=i selected=(pagination.limitItem == i ? true : false)) #{i} items per page

    //- Modal để xem người tạo, người cập nhật và người xoá sản phẩm
    +modal()

    if (role.permissions.includes('blog_edit'))
      form(
        action=""
        method="POST"
        id = 'form-change-status'
        data-path = `${prefixAdmin}/blog/change-status`
      ) 

      form(
        action=""
        method="POST"
        id = 'form-change-featured'
        data-path = `${prefixAdmin}/blog/change-featured`
      ) 

      form(
        action=""
        method="POST"
        id = 'form-delete'
        data-path = `${prefixAdmin}/blog/delete-product`
      ) 
                
      // LIST PRODUCTS END
      script(src="/js/admin/changePosition.js")
      script(src="/js/admin/changeStatus.js")
      script(src="/js/admin/deleteProduct.js")
      script(src="/js/admin/fontend/modal.js")
  else 
    .notFound
      .icon <i class="fa-solid fa-lock" style="color: #aaaaaa;"></i>
      .title You do not have access
      .description Contact your organization administrator(s) for more information 
      button.btn.btn-primary.p-2(onclick="history.back()") Return to previous page
